3. 整体训练
   1. backbone训练
   2. 训练流程
   3. 损失设置
   4. 可视化

## backbone训练
正常训练，记录，学习率变化。
src/train_backbone.py

## 训练流程
首先对于标注对每个batch，我们整理每张图片的标注成张量，然后放到列表中，这个也能放到前面的DataLoader相关函数中。如果标注是空的，放置空张量。
## 损失设置
首先我们要处理框，标注是左上角点和长宽，而网络预测的是中心点和长宽，IoU计算函数要的是左上右下角坐标。所以我们先用torchvision.ops.box_convert做转化。我们计算标注和预测框的IoU利用torchvision.ops.box_iou,获取正样本，即和标注IoU最大的唯一，然后我们设置IoU的值小于阈值的为负样本，然后将正样本的四个值做MSE损失，注意要转化格式，比如统一中心点长宽，然后我们要乘惩罚小框即(2-w*h)，然后得到对框坐标的损失。对于正样本的置信度做和一的BCE损失，对类别做和独热的BCE损失，对负样本做对置信度和零的BCE损失。注意类别不是连续的所以我们需要做转化然后处理损失。
最后损失乘不同权重得到最终的损失。
我们会对每个层次，3个，batch中的每张图片做损失处理，然后反向传播。
src/train.py
## 可视化
我们首先对图片做反归一化，然后根据类别标签得到实际类别的名字，然后同样处理预测的，我们要将类别的概率乘图片的置信度得到它真正的置信度，然后用这个根据阈值得到掩码，筛选出阈值之上的。然后我们利用batched_nms根据IoU筛，最后用draw_bounding_boxes画出框，然后显示。这里框的格式同样重要。画框还是要左上右下。


